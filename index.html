<div id="feed">Loading posts...</div>

<script>
const WORKER_URL = "https://cool-hall-3591.thebigbugatti24-8a8.workers.dev";

function soundcloudEmbed(url) {
  const encoded = encodeURIComponent(url);
  return `<iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay"
          src="https://w.soundcloud.com/player/?url=${encoded}&color=%23ff5500&auto_play=false"></iframe>`;
}

async function likePost(postId) {
  await fetch(WORKER_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "like", postId })
  });
  loadFeed(); // refresh feed
}

async function loadFeed() {
  const res = await fetch(WORKER_URL);
  const data = await res.json();
  const feed = document.getElementById("feed");
  feed.innerHTML = "";
  data.posts.forEach(post => {
    const div = document.createElement("div");
    div.className = "post";
    div.innerHTML = `
      <span class="user">${post.user}</span><br>
      ${soundcloudEmbed(post.url)}
      <br>
      <button onclick="likePost(${post.id})">üëç Like (${post.likes || 0})</button>
    `;
    feed.appendChild(div);
  });
}

loadFeed();
setInterval(loadFeed, 3000);
</script>
